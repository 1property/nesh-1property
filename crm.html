<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Real Estate CRM</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body{font-family:Poppins;background:#f6f7fb;}
.table-wrapper{background:#fff;padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);}
.page{display:none;}
</style>
</head>

<body>

<!-- PASSWORD -->
<script>
(function(){
if(!sessionStorage.getItem("crm_access")){
let p=prompt("Enter CRM password:");
if(p!=="12345"){ alert("Wrong password"); location.href="index.html"; }
sessionStorage.setItem("crm_access","true");
}
})();
</script>

<header class="text-center mt-3">
<h2>Real Estate CRM System</h2>
</header>

<!-- NAVBAR -->
<nav class="navbar navbar-light bg-white shadow-sm mb-4">
<div class="container">
<ul class="navbar-nav flex-row gap-3">

<li><a class="nav-link" href="index.html">Home</a></li>
<li><a class="nav-link" onclick="showPage('buyerPage')">Buyer</a></li>
<li><a class="nav-link" onclick="showPage('sellerPage')">Seller</a></li>
<li><a class="nav-link" onclick="showPage('rentPage')">Rent</a></li>
<li><a class="nav-link" href="loancrm.html">Loan CRM</a></li>
<li><a class="nav-link" href="appointment.html">Appointments</a></li>
<li><a class="nav-link" onclick="showPage('financialPage')">Financial</a></li>

</ul>
</div>
</nav>

<div class="container">

<!-- BUYER -->
<section id="buyerPage" class="page">
<h4>Buyer List</h4>
<div class="table-wrapper">
<table class="table">
<thead><tr><th>Name</th><th>Phone</th></tr></thead>
<tbody id="buyer-table-body"></tbody>
</table>
</div>
</section>

<!-- SELLER -->
<section id="sellerPage" class="page">
<h4>Seller List</h4>
<div class="table-wrapper">
<table class="table">
<thead><tr><th>Name</th><th>Phone</th></tr></thead>
<tbody id="seller-table-body"></tbody>
</table>
</div>
</section>

<!-- RENT -->
<section id="rentPage" class="page">
<h4>Rent List</h4>
<div class="table-wrapper">
<table class="table">
<thead><tr><th>Tenant</th><th>Rent</th></tr></thead>
<tbody id="rent-table-body"></tbody>
</table>
</div>
</section>

<!-- FINANCIAL -->
<section id="financialPage" class="page">

<h4>Financial Tools</h4>

<div class="mb-3">
<button class="btn btn-outline-primary btn-sm" onclick="showFinance('dsrBox')">DSR</button>
<button class="btn btn-outline-success btn-sm" onclick="showFinance('costBox')">Cost</button>
</div>

<!-- DSR -->
<div id="dsrBox">
<div class="row g-2">
<div class="col-md-4">
<input id="dsr_income" class="form-control" placeholder="Net Income">
</div>
<div class="col-md-4">
<input id="dsr_debt" class="form-control" placeholder="Total Debt">
</div>
<div class="col-md-4">
<button class="btn btn-primary w-100" onclick="calcDSR()">Calculate</button>
</div>
</div>
<p class="mt-2"><b>DSR:</b> <span id="dsr_result">-</span></p>
</div>

<!-- COST -->
<div id="costBox" style="display:none;">
<div class="row g-2">
<div class="col-md-6">
<input id="cost_price" class="form-control" placeholder="Property Price">
</div>
<div class="col-md-6">
<input id="cost_margin" class="form-control" value="90" placeholder="Loan Margin">
</div>
<div class="col-md-12">
<button class="btn btn-success w-100" onclick="calcCost()">Calculate</button>
</div>
</div>
<div class="mt-2" id="cost_output"></div>
</div>

</section>

</div>

<script>

function showPage(id){
document.querySelectorAll('.page').forEach(p=>p.style.display='none');
document.getElementById(id).style.display='block';
}

function showFinance(id){
document.getElementById("dsrBox").style.display="none";
document.getElementById("costBox").style.display="none";
document.getElementById(id).style.display="block";
}

function calcDSR(){
let income=parseFloat(dsr_income.value)||0;
let debt=parseFloat(dsr_debt.value)||0;
if(income===0){alert("Enter income");return;}
let dsr=(debt/income)*100;
dsr_result.innerText=dsr.toFixed(2)+"%";
}

function calcCost(){
let price=parseFloat(cost_price.value)||0;
let margin=parseFloat(cost_margin.value)||90;
if(price===0){alert("Enter price");return;}
let loan=price*(margin/100);
let down=price-loan;
let legal=price*0.01;
let total=down+legal;
cost_output.innerHTML=`
Loan: RM ${loan.toLocaleString()}<br>
Downpayment: RM ${down.toLocaleString()}<br>
Legal: RM ${legal.toLocaleString()}<br>
<b>Total Cash: RM ${total.toLocaleString()}</b>`;
}

document.addEventListener("DOMContentLoaded",()=>showPage('buyerPage'));

</script>

<script src="script.js"></script>
</body>
</html>
