<!-- crm.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Real Estate CRM</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; background: #f6f7fb; }
    header h1 { text-align: center; margin: 18px 0 6px; font-weight: 600; }
    .table-wrapper { background: #fff; padding: 14px; border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.04);}
    .cursor-pointer { cursor: pointer; }
    @media (max-width: 768px) {.table-responsive { font-size: 0.95rem; }}
  </style>
</head>

<body>

<!-- PASSWORD PROTECTION (UNCHANGED) -->
<script>
(function () {
const allowedPassword = "12345";
if (!sessionStorage.getItem("crm_access")) {
let attempts = 3;
while (attempts > 0) {
let input = prompt(`Enter password (Attempts left: ${attempts})`);
if (input === null) { window.location.href="index.html"; return; }
if (input === allowedPassword) { sessionStorage.setItem("crm_access","true"); break; }
attempts--; alert("Wrong password!");
}
if (attempts===0) window.location.href="index.html";
}
})();
</script>

<header>
<h1>Real Estate CRM System</h1>
<div class="text-center text-muted mb-2">Manage Buyers, Sellers and Renters ‚Äî powered by Supabase</div>

<!-- QUICK ACCESS BUTTONS (NEW SAFE ADD) -->
<div class="text-center mt-2">
<a href="appointment.html" class="btn btn-outline-warning btn-sm m-1">üìÖ Appointments</a>
</div>
</header>

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
<div class="container">
<a class="navbar-brand fw-semibold" href="#">üè° Real Estate CRM</a>

<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
<span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="navMenu">
<ul class="navbar-nav ms-auto gap-2">

<a class="nav-link cursor-pointer" href="index.html">Home</a>
<li class="nav-item"><a class="nav-link cursor-pointer" data-target="buyerPage">Buyer List</a></li>
<li class="nav-item"><a class="nav-link cursor-pointer" data-target="sellerPage">Seller List</a></li>
<li class="nav-item"><a class="nav-link cursor-pointer" data-target="rentPage">Renter List</a></li>
<a class="nav-link cursor-pointer" href="loancrm.html">Loan CRM</a>

<!-- NEW FINANCIAL BUTTON -->
<li class="nav-item">
<a class="nav-link cursor-pointer" data-target="financialPage">Financial Tools</a>
</li>

</ul>
</div>
</div>
</nav>

<main class="container mb-5">

<!-- BUYER PAGE -->
<section id="buyerPage" class="page">
<h4>Buyer List</h4>
</section>

<!-- SELLER PAGE -->
<section id="sellerPage" class="page d-none">
<h4>Seller List</h4>
</section>

<!-- RENT PAGE -->
<section id="rentPage" class="page d-none">
<h4>Renter List</h4>
</section>

<!-- ============================= -->
<!-- NEW FINANCIAL TOOLS PAGE -->
<!-- ============================= -->

<section id="financialPage" class="page d-none">

<div class="d-flex justify-content-between align-items-center mb-3">
<h4 class="m-0">Financial Tools</h4>
<div>
<button class="btn btn-outline-primary btn-sm" onclick="showFinance('dsrBox')">DSR</button>
<button class="btn btn-outline-success btn-sm" onclick="showFinance('costBox')">Cost</button>
</div>
</div>

<!-- DSR -->
<div id="dsrBox">
<div class="row g-2">
<div class="col-md-4">
<input id="dsr_income" class="form-control" placeholder="Net Income">
</div>
<div class="col-md-4">
<input id="dsr_debt" class="form-control" placeholder="Total Debt">
</div>
<div class="col-md-4">
<button class="btn btn-primary w-100" onclick="calcDSR()">Calculate</button>
</div>
</div>
<div class="mt-3">
<b>DSR Result:</b> <span id="dsr_result">-</span>
</div>
</div>

<!-- COST -->
<div id="costBox" style="display:none;">
<div class="row g-2">
<div class="col-md-6">
<input id="cost_price" class="form-control" placeholder="Property Price">
</div>
<div class="col-md-6">
<input id="cost_margin" class="form-control" value="90" placeholder="Loan Margin %">
</div>
<div class="col-md-12">
<button class="btn btn-success w-100" onclick="calcCost()">Calculate</button>
</div>
</div>
<div class="mt-3" id="cost_output"></div>
</div>

</section>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js" defer></script>

<!-- ============================= -->
<!-- NEW SCRIPT (SAFE ADD ONLY) -->
<!-- ============================= -->

<script>

/* PAGE SWITCH */
document.querySelectorAll("[data-target]").forEach(btn=>{
btn.addEventListener("click",()=>{
document.querySelectorAll(".page").forEach(p=>p.classList.add("d-none"));
document.getElementById(btn.dataset.target).classList.remove("d-none");
});
});

/* FINANCIAL SWITCH */
function showFinance(id){
document.getElementById("dsrBox").style.display="none";
document.getElementById("costBox").style.display="none";
document.getElementById(id).style.display="block";
}

/* DSR CALCULATOR */
function calcDSR(){
let income=parseFloat(dsr_income.value)||0;
let debt=parseFloat(dsr_debt.value)||0;
if(income<=0){ dsr_result.innerText="Enter income"; return; }
let dsr=(debt/income)*100;
dsr_result.innerText=dsr.toFixed(2)+"%";
}

/* COST CALCULATOR */
function calcCost(){
let price=parseFloat(cost_price.value)||0;
let margin=parseFloat(cost_margin.value)||0;
if(price<=0){ cost_output.innerHTML="Enter property price"; return; }
let loan=(price*margin)/100;
let down=price-loan;
cost_output.innerHTML=`
Loan Amount: RM ${loan.toLocaleString()}<br>
Downpayment: RM ${down.toLocaleString()}
`;
}

</script>

</body>
</html>
