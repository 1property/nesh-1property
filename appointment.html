<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nesh Property – Appointment Slots</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#f4f6fb;
  font-family:'Poppins', sans-serif;
}
header{
  text-align:center;
  margin:40px 0 25px;
}
.table td{
  cursor:pointer;
  font-size:14px;
  transition:0.2s;
}
.table-success{
  background:#d4edda !important;
}
.table-danger{
  background:#f8d7da !important;
  border:2px solid #dc3545 !important;
}
.badge-time{
  font-size:13px;
  padding:6px 10px;
}
.modal-body{
  font-size:15px;
}
</style>
</head>

<body>

<div class="container">

<header>
<h2 class="fw-bold">Appointment Slot Management</h2>
<a href="crm.html" class="btn btn-outline-dark btn-sm mt-2">← Back to CRM</a>
</header>

<div class="table-responsive">
<table class="table table-bordered text-center align-middle shadow-sm">
<thead class="table-primary">
<tr>
<th>Date</th>
<th>09:00</th><th>10:00</th><th>11:00</th><th>12:00</th>
<th>13:00</th><th>14:00</th><th>15:00</th><th>16:00</th>
<th>17:00</th><th>18:00</th><th>19:00</th><th>20:00</th>
</tr>
</thead>
<tbody id="appointmentBody"></tbody>
</table>
</div>

</div>

<!-- MODAL -->
<div class="modal fade" id="bookingModal">
<div class="modal-dialog">
<div class="modal-content">

<div class="modal-header">
<h5 class="modal-title fw-semibold">Appointment Details</h5>
<button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body" id="modalBody"></div>

<div class="modal-footer" id="modalFooter"></div>

</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

const hours = ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"];
let modal = new bootstrap.Modal(document.getElementById('bookingModal'));
let currentKey = "";
let currentDate = "";
let currentTime = "";

// ===== GENERATE TABLE =====
function generateAppointments(){
  const body=document.getElementById("appointmentBody");
  body.innerHTML="";

  const today=new Date();

  for(let i=0;i<14;i++){
    const d=new Date();
    d.setDate(today.getDate()+i);

    const yyyy=d.getFullYear();
    const mm=String(d.getMonth()+1).padStart(2,'0');
    const dd=String(d.getDate()).padStart(2,'0');
    const dateStr=`${yyyy}-${mm}-${dd}`;

    let row=`<tr><td class="fw-semibold">${dateStr}</td>`;

    hours.forEach(time=>{
      const key=dateStr+"_"+time;
      const saved=localStorage.getItem(key);

      let display="Available";
      let color="table-success";

      if(saved){
        const data=JSON.parse(saved);
        display=data.name;
        color="table-danger";
      }

      row+=`<td class="${color}" onclick="openSlot('${dateStr}','${time}')">${display}</td>`;
    });

    row+="</tr>";
    body.innerHTML+=row;
  }
}

// ===== OPEN SLOT =====
function openSlot(date,time){

  currentKey=date+"_"+time;
  currentDate=date;
  currentTime=time;

  const existing=localStorage.getItem(currentKey);

  if(existing){
    const data=JSON.parse(existing);

    document.getElementById("modalBody").innerHTML=`
      <div class="mb-3">
        <span class="badge bg-primary badge-time">${date}</span>
        <span class="badge bg-dark badge-time">${time}</span>
      </div>

      <span class="badge bg-success mb-3">Confirmed Booking</span>

      <p><b>Name:</b> ${data.name}</p>
      <p><b>Phone:</b> ${data.phone || "-"}</p>
      <p><b>Notes:</b> ${data.notes || "-"}</p>
    `;

    document.getElementById("modalFooter").innerHTML=`
      <button class="btn btn-success" onclick="sendWhatsApp('${data.phone}','${data.name}')">WhatsApp</button>
      <button class="btn btn-danger" onclick="deleteBooking()">Delete</button>
      <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
    `;
  }
  else{
    document.getElementById("modalBody").innerHTML=`
      <div class="mb-3">
        <span class="badge bg-primary badge-time">${date}</span>
        <span class="badge bg-dark badge-time">${time}</span>
      </div>

      <input id="name" class="form-control mb-2" placeholder="Client Name">
      <input id="phone" class="form-control mb-2" placeholder="Phone Number">
      <textarea id="notes" class="form-control" placeholder="Notes (optional)"></textarea>
    `;

    document.getElementById("modalFooter").innerHTML=`
      <button class="btn btn-primary" onclick="saveBooking()">Save Booking</button>
      <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    `;
  }

  modal.show();
}

// ===== SAVE =====
function saveBooking(){
  const name=document.getElementById("name").value;
  if(!name){ alert("Enter client name"); return; }

  const phone=document.getElementById("phone").value;
  const notes=document.getElementById("notes").value;

  localStorage.setItem(currentKey, JSON.stringify({name,phone,notes}));
  modal.hide();
  generateAppointments();
}

// ===== DELETE =====
function deleteBooking(){
  if(confirm("Delete this booking?")){
    localStorage.removeItem(currentKey);
    modal.hide();
    generateAppointments();
  }
}

// ===== WHATSAPP =====
function sendWhatsApp(phone,name){
  if(!phone){ alert("No phone number saved"); return; }

  phone=phone.replace(/^0/,"60");

  const msg = `Hi ${name},
Your appointment with Nesh Property is confirmed.

Date: ${currentDate}
Time: ${currentTime}

See you soon!`;

  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, "_blank");
}

document.addEventListener("DOMContentLoaded", generateAppointments);

</script>

</body>
</html>